<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script type="module">
       function initIMClient() {
        this.imClientMgr.setup(this.uid, this.username)
        this.imClientMgr.onIMMsg((msg) => {
          this.addToChatList(msg)
        })
        this.imClientMgr.onMsgAck((ack) => {
          const item = this.sendingList.filter((m) => m.sendTime === ack.sendTime)[0]
          if (!item) return
          item.isSending = false
          item.sendFailed = false
          item.msgId = ack.msgId
          const index = this.sendingList.indexOf(item)
          this.sendingList.splice(index, 1)
        })
        this.imClientMgr.onRevokeMsg(({ msgId }) => {
          const msg_item = this.msgList.filter((m) => m.msgId === msgId)[0]
          const index = this.msgList.indexOf(msg_item)
          if (index > -1) {
            this.msgList.splice(index, 1)
          }
        })
      }
    </script>
</body>
</html>